import{_ as s,c as n,e,a,f as l,o as i}from"./app-CY5xcLzz.js";const c={},d=a("h1",{id:"caddy",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#caddy"},[a("span",null,"Caddy")])],-1),t=l(`<h2 id="手动安装" tabindex="-1"><a class="header-anchor" href="#手动安装"><span>手动安装</span></a></h2><h3 id="下载" tabindex="-1"><a class="header-anchor" href="#下载"><span>下载</span></a></h3><p>打开 <a href="https://caddyserver.com/download" target="_blank" rel="noopener noreferrer">下载</a> 页面，选择对应的平台后点击下载按钮</p><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h3><p>移动下载的二进制文件到 <code>/usr/bin/</code></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">sudo</span> <span class="token function">mv</span> caddy_linux_amd64 /usr/bin/caddy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改 <code>caddy</code> 权限</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">755</span> /usr/bin/caddy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>测试是否有效</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ caddy version</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>创建一个名为 <code>caddy</code> 的组</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">sudo</span> <span class="token function">groupadd</span> <span class="token parameter variable">--system</span> caddy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>创建一个名为 <code>caddy</code> 且有可写的主目录的用户</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">sudo</span> <span class="token function">useradd</span> <span class="token parameter variable">--system</span> <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--gid</span> caddy <span class="token punctuation">\\</span></span>
<span class="line">    --create-home <span class="token punctuation">\\</span></span>
<span class="line">    --home-dir /var/lib/caddy <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--shell</span> /usr/sbin/nologin <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--comment</span> <span class="token string">&quot;Caddy web server&quot;</span> <span class="token punctuation">\\</span></span>
<span class="line">    caddy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h3><p>创建一个名为 <code>Caddyfile</code> 的配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">sudo</span> <span class="token function">mkdir</span> /etc/caddy</span>
<span class="line">$ <span class="token function">sudo</span> <span class="token function">touch</span> /etc/caddy/Caddyfile</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Caddyfile</code> 内容示例</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">foobar.com, www.foobar.com {</span>
<span class="line">  root * /var/www/foobar.com</span>
<span class="line">  file_server</span>
<span class="line"></span>
<span class="line">  encode zstd gzip</span>
<span class="line"></span>
<span class="line">  route {</span>
<span class="line">    try_files {path} /index.html</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="服务" tabindex="-1"><a class="header-anchor" href="#服务"><span>服务</span></a></h3><p>将服务文件下载到 <code>/etc/systemd/system</code></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">sudo</span> <span class="token function">wget</span> <span class="token parameter variable">-P</span> /etc/systemd/system https://raw.githubusercontent.com/caddyserver/dist/master/init/caddy.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启用 <code>caddy</code> 服务</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">sudo</span> systemctl daemon-reload</span>
<span class="line">$ <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> caddy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>检查是否在运行中</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ systemctl status caddy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="日志" tabindex="-1"><a class="header-anchor" href="#日志"><span>日志</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">sudo</span> journalctl <span class="token parameter variable">-u</span> caddy <span class="token parameter variable">-f</span> <span class="token parameter variable">-o</span> json-pretty</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="docker-compose" tabindex="-1"><a class="header-anchor" href="#docker-compose"><span>Docker Compose</span></a></h2><h3 id="设置" tabindex="-1"><a class="header-anchor" href="#设置"><span>设置</span></a></h3><p>创建一个名为 <code>compose.yml</code> 的文件，写入以下内容</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">caddy</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> caddy<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;80:80&quot;</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;443:443&quot;</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;443:443/udp&quot;</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./Caddyfile<span class="token punctuation">:</span>/etc/caddy/Caddyfile</span>
<span class="line">      <span class="token punctuation">-</span> ./site<span class="token punctuation">:</span>/srv</span>
<span class="line">      <span class="token punctuation">-</span> caddy_data<span class="token punctuation">:</span>/data</span>
<span class="line">      <span class="token punctuation">-</span> caddy_config<span class="token punctuation">:</span>/config</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">caddy_data</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">caddy_config</span><span class="token punctuation">:</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>compose.yml</code> 旁边创建一个名为 <code>Caddyfile</code> 的配置文件，并写入相关内容。</p><p>如果有静态文件，在 <code>compose.yml</code> 旁边创建一个名为 <code>site</code> 的目录，将静态文件放入其中，然后使用 <code>root * /srv</code> 设置根目录。</p><div class="hint-container tip"><p class="hint-container-title">反向代理</p><p>如果要反向代理到另一个容器，不要使用 <code>reverse_proxy localhost:8080</code> ，而是使用 <code>reverse_proxy other-container:8080</code> ，并确保两个容器网络互通</p></div><h3 id="用法" tabindex="-1"><a class="header-anchor" href="#用法"><span>用法</span></a></h3><p>启动</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>停止</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">docker</span> compose down</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,40);function p(o,r){return i(),n("div",null,[d,e(" more "),t])}const v=s(c,[["render",p],["__file","caddy.html.vue"]]),m=JSON.parse('{"path":"/tutorial/caddy.html","title":"Caddy","lang":"zh-CN","frontmatter":{"title":"Caddy","date":"2021-07-23T10:33:16.000Z","category":["教程"],"order":1,"head":[["meta",{"property":"og:url","content":"https://wome.ng/tutorial/caddy.html"}],["meta",{"property":"og:site_name","content":"我梦的笔记本"}],["meta",{"property":"og:title","content":"Caddy"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-06-26T08:51:59.000Z"}],["meta",{"property":"article:author","content":"我梦"}],["meta",{"property":"article:published_time","content":"2021-07-23T10:33:16.000Z"}],["meta",{"property":"article:modified_time","content":"2024-06-26T08:51:59.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Caddy\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2021-07-23T10:33:16.000Z\\",\\"dateModified\\":\\"2024-06-26T08:51:59.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"我梦\\",\\"url\\":\\"https://wome.ng\\"}]}"]]},"headers":[{"level":2,"title":"手动安装","slug":"手动安装","link":"#手动安装","children":[{"level":3,"title":"下载","slug":"下载","link":"#下载","children":[]},{"level":3,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":3,"title":"配置","slug":"配置","link":"#配置","children":[]},{"level":3,"title":"服务","slug":"服务","link":"#服务","children":[]},{"level":3,"title":"日志","slug":"日志","link":"#日志","children":[]}]},{"level":2,"title":"Docker Compose","slug":"docker-compose","link":"#docker-compose","children":[{"level":3,"title":"设置","slug":"设置","link":"#设置","children":[]},{"level":3,"title":"用法","slug":"用法","link":"#用法","children":[]}]}],"git":{"createdTime":1719391919000,"updatedTime":1719391919000,"contributors":[{"name":"Foobar","email":"github@foobar.com","commits":1}]},"readingTime":{"minutes":1.32,"words":397},"filePathRelative":"tutorial/caddy.md","localizedDate":"2021年7月23日","excerpt":"\\n"}');export{v as comp,m as data};
